# 菜谱导入解决方案

## 问题概述

Kitchen Helper应用需要从CSV文件导入菜谱数据到Supabase数据库。导入过程需要处理菜谱基本信息、食材、调料、厨具等数据，并建立它们之间的关联关系。

## 解决方案

我们提供了两种导入方法，以满足不同的需求和技术水平：

### 1. SQL脚本直接导入（推荐）

- 文件：`sql/all_in_one_import.sql`
- 描述：一个完整的SQL脚本，包含所有导入步骤
- 执行方式：在Supabase SQL编辑器中直接执行
- 优点：简单直接，无需额外设置

### 2. Node.js脚本导入

- 目录：`scripts/supabase/`
- 主要文件：`update_connect_import.js`
- 描述：通过Supabase JavaScript客户端连接并执行导入
- 执行方式：设置API密钥后运行Node.js脚本
- 优点：可自动处理错误，提供更好的反馈

## 导入内容

导入脚本会导入以下数据：

1. **系统基础数据**
   - 系统用户和食材分类

2. **食材库存**
   - 各类食材，按照类型分类：蔬菜、肉类、调料等
   - 厨房工具如：锅、刀、砧板等

3. **菜谱数据**
   - 中式菜谱：番茄炒鸡蛋、蚝油生菜等
   - 西式菜谱：意面、三明治等
   - 包含难度、烹饪时间、标签等信息

4. **菜谱-食材关系**
   - 每个菜谱需要的具体食材
   - 食材用量和单位

## 使用说明

详细的使用指南请参阅 `IMPORT_GUIDE.md` 文件。简要步骤：

### 方法一：SQL脚本导入

1. 登录Supabase控制台
2. 打开SQL编辑器
3. 复制`sql/all_in_one_import.sql`文件内容
4. 执行脚本

### 方法二：Node.js脚本导入

1. 进入`scripts/supabase/`目录
2. 安装依赖：`npm install`
3. 运行导入：`npm run import:direct <your_supabase_key>`

## 技术实现细节

1. **临时表处理**：使用PostgreSQL临时表存储CSV数据
2. **数据验证**：检查数据完整性和正确性
3. **错误处理**：跳过已存在的记录，避免重复导入
4. **分类映射**：英文分类名自动映射到中文界面分类
5. **关系处理**：正确建立菜谱和食材的多对多关系
6. **UUID生成**：为每条记录生成唯一ID

## 常见问题解决

1. **重复数据**：脚本设计为可重复执行，自动跳过已有记录
2. **连接问题**：提供了详细的连接错误处理和解决方案
3. **权限问题**：包含创建必要函数的SQL脚本
4. **数据缺失**：为所有必填字段提供合理默认值
5. **分类映射**：自动处理英文CSV分类到中文系统分类的映射 